var __t;__t=function(ns){var curr,index,part,parts,_i,_len;curr=null,parts=[].concat=ns.split(".");for(index=_i=0,_len=parts.length;_i<_len;index=++_i){part=parts[index];if(curr===null){curr=eval(part);continue}curr[part]==null?curr=curr[part]={}:curr=curr[part]}return curr};var toaster=exports.toaster={};((function(){var Toaster,debug,error,growl,icon_error,icon_warn,interval,log,msgs,process_msgs,queue_msg,start_worker,stop_worker,warn,__slice=[].slice,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};__t("toaster.generators").Question=function(){function a(){}return a.prototype.ask=function(a,b,c){var d,e,f=this;return d=process.stdin,e=process.stdout,e.write(""+a+" "),d.once("data",function(d){var g,h;return d=d.toString().trim(),b.test(d)?c(d.trim()):(g=""+"Invalid entry, it should match:".red,h=""+b.toString().cyan,e.write("\t"+g+" "+h+"\n"),f.ask(a,b,c))}).resume()},a}(),__t("toaster.utils").ArrayUtil=function(){function a(){}return a.find=function(a,b,c){var d,e,f,g,h,i,j,k,l;if(!c)for(d=g=0,j=a.length;g<j;d=++g){f=a[d];if(f===b)return{item:f,index:d}}else{c=[].concat(c);for(d=h=0,k=a.length;h<k;d=++h){f=a[d];for(i=0,l=c.length;i<l;i++){e=c[i];if(b===f[e])return{item:f,index:d}}}}return null},a.find_all=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q;p=[],q={};if(c===null)for(g=j=0,m=a.length;j<m;g=++j)i=a[g],d?b.test(i)&&(f={item:i,index:g}):b===i&&(f={item:i,index:g}),f&&p.push(f);else{c=[].concat(c);for(g=k=0,n=a.length;k<n;g=++k){i=a[g];for(l=0,o=c.length;l<o;l++)h=c[l],f=null,d?b.test(i[h])&&(e&&!q[g]?f={item:i,index:g}:e===!1&&(f={item:i,index:g})):b===i[h]&&(f={item:i,index:g}),f&&(q[g]=!0,p.push(f))}}return p},a.diff=function(b,c,d){var e,f,g,h,i,j,k;b==null&&(b=[]),c==null&&(c=[]),e=[];for(h=0,j=b.length;h<j;h++)f=b[h],g=d!=null?f[d]:f,a.has(c,g,d)||e.push({item:f,action:"deleted"});for(i=0,k=c.length;i<k;i++)f=c[i],g=d!=null?f[d]:f,a.has(b,g,d)||e.push({item:f,action:"created"});return e},a.has=function(b,c,d){return a.find(b,c,d)!=null},a.replace_into=function(a,b,c){c=[].concat(c),a.splice(b,1);while(c.length)a.splice(b++,0,c.shift());return a},a}(),__t("toaster.utils").FnUtil=function(){function a(){}return a.proxy=function(){var a,b;return a=arguments[0],b=2<=arguments.length?__slice.call(arguments,1):[],function(){var c;return c=1<=arguments.length?__slice.call(arguments,0):[],a.apply(null,b.concat(c))}},a}(),__t("toaster.utils").FsUtil=function(){function f(){}var a,b,c,d,e;return d=require("path"),c=require("fs"),e=require("path").normalize,b=toaster.utils.FnUtil,a=toaster.utils.ArrayUtil,f.rmdir_rf=function(a,b){var d,e,g,h,i;b==null&&(b=!0),e=c.readdirSync(a);for(h=0,i=e.length;h<i;h++)d=e[h],d=""+a+"/"+d,g=c.lstatSync(d),g.isDirectory()?(f.rmdir_rf(d,!1),c.rmdirSync(d)):c.unlinkSync(d);if(b)return c.rmdirSync(a)},f.mkdir_p=function(a){var b,e,f,g,h,i;a.slice(-1)==="/"&&(a=a.slice(0,-1)),f=a.split("/");for(g=h=0,i=f.length;h<i;g=++h){e=f[g];if((e=f.slice(0,g+1).join("/"))==="")continue;b=d.existsSync(e);if(b&&g===f.length-1)throw new Error(error("Folder exists: "+e.red));b||c.mkdirSync(e,"0755")}return!0},f.find=function(a,b,d){var g,h,i,j,k,l,m;d==null&&(d=!1),j=[],i=c.readdirSync(a);for(l=0,m=i.length;l<m;l++)g=i[l],h=e(""+a+"/"+g),c.lstatSync(h).isDirectory()?(d&&h.match(b)&&(j=j.concat(h)),k=f.find(h,b,d),j=j.concat(k)):h.match(b)&&j.push(h);return j},f.ls_folders=function(a){var b,d,e,f,g,h;f=[],e=c.readdirSync(a);for(g=0,h=e.length;g<h;g++)b=e[g],d=""+a+"/"+b,c.lstatSync(d).isDirectory()&&f.push(d);return f},f.take_snapshot=function(a){var b,d,e,f,g,h,i;f=[],e=c.readdirSync(a);for(h=0,i=e.length;h<i;h++)b=e[h],d=""+a+"/"+b,c.lstatSync(d).isDirectory()?g="folder":g="file",f.push({type:g,path:d});return f},f.watch_file=function(a,b,d){var g=this;return a=e(a),f.unwatch_file(a),d&&typeof b=="function"&&b({type:"file",path:a,action:"created"}),typeof b=="function"&&b({type:"file",path:a,action:"watching"}),c.watchFile(a,{interval:250},function(c,d){var e,f;f=c.mtime.valueOf()!==d.mtime.valueOf(),e=c.ctime.valueOf()!==d.ctime.valueOf();if(f||e)return typeof b=="function"?b({type:"file",path:a,action:"updated"}):void 0})},f.unwatch_file=function(a,b){return f.watched[a]=!1,c.unwatchFile(a)},f.snapshots={},f.watchers={},f.watched={},f.watch_folder=function(a,d,g,h){var i,j,k,l,m,n;f.watchers[a]?k=f.watchers[a]:k=f.watchers[a]=[],a=e(a),typeof g=="function"&&g({type:"folder",path:a,action:"watching"}),f.snapshots[a]=f.take_snapshot(a),n=f.snapshots[a];for(l=0,m=n.length;l<m;l++){i=n[l];if(i.type==="folder")h&&g({type:i.type,path:i.path,action:"created"}),f.watch_folder(i.path,d,g,h);else if(d===null||d.test(i.path))h&&g({type:i.type,path:i.path,action:"created"}),f.watch_file(i.path,g)}k.push({folderpath:a,filter:d,onchange:g,dispatch_create:h});if(!f.watched[a])return f.watched[a]=!0,j=b.proxy(f._on_folder_change,a),c.unwatchFile(a),c.watchFile(a,{interval:250},j)},f._on_folder_change=function(b,e,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(!d.existsSync(b))return;h=f.snapshots[b],i=f.snapshots[b]=f.take_snapshot(b),j=a.diff(h,i,"path");if(!j.length)return;n=f.watchers[b],u=[];for(o=0,r=j.length;o<r;o++){l=j[o],k=l.item,k.action=l.action;if(k.action==="created")k.type==="file"?u.push(function(){var a,b,c;c=[];for(a=0,b=n.length;a<b;a++)m=n[a],m.filter.test(k.path)?(typeof m.onchange=="function"&&m.onchange(k),c.push(f.watch_file(k.path,m.onchange))):c.push(void 0);return c}()):k.type==="folder"?u.push(function(){var a,b,c;c=[];for(a=0,b=n.length;a<b;a++)m=n[a],typeof m.onchange=="function"&&m.onchange(k),c.push(f.watch_folder(k.path,m.filter,m.onchange,!0));return c}()):u.push(void 0);else if(k.action==="deleted")if(k.type==="file"){for(p=0,s=n.length;p<s;p++)m=n[p],m.filter.test(k.path)&&typeof m.onchange=="function"&&m.onchange(k);c.unwatchFile(k.path),u.push(f.watched[k.path]=!1)}else if(k.type==="folder"){for(q=0,t=n.length;q<t;q++)m=n[q],typeof m.onchange=="function"&&m.onchange(k);u.push(f.unwatch_folder(k.path))}else u.push(void 0);else u.push(void 0)}return u},f.unwatch_folder=function(a,b){var d,e,g,h,i,j,k;i=f.watchers;for(h in i)g=i[h],(new RegExp("^"+a)).test(h)&&(f.watchers[h]=null);j=f.watched,k=[];for(e in j)d=j[e],d&&(new RegExp("^"+a)).test(e)?(f.watched[e]=!1,k.push(c.unwatchFile(e))):k.push(void 0);return k},f}.call(this),growl=require("growl"),icon_warn="/Users/nybras/Dropbox/Workspace/serpentem/coffee-toaster/images/warning.png",icon_error="/Users/nybras/Dropbox/Workspace/serpentem/coffee-toaster/images/error.png",log=function(a,b){return b==null&&(b=!1),console.log(a),a},debug=function(a,b){return b==null&&(b=!1),a=log(""+a.magenta),a},error=function(a,b,c){return b==null&&(b=!0),c==null&&(c=null),a=log("ERROR ".bold.red+a),b&&(a=a.replace(/\[\d{2}m/g,""),a=a.replace(/(\[\dm)([^\s]+)/ig,"<$2>$3"),queue_msg({msg:a,opts:{title:"Coffee Toaster",image:icon_error}})),a},warn=function(a,b){return b==null&&(b=!0),a=log("WARNING ".bold.yellow+a),b&&(a=a.replace(/\[\d{2}m/g,""),a=a.replace(/(\[\dm)([^\s]+)/ig,"<$2>$3"),queue_msg({msg:a,opts:{title:"Coffee Toaster",image:icon_warn}})),a},msgs=[],interval=null,start_worker=function(){if(interval==null)return interval=setInterval(process_msgs,150),process_msgs()},stop_worker=function(){if(interval!=null)return clearInterval(interval),interval=null},queue_msg=function(a){return msgs.push(a),start_worker()},process_msgs=function(){var a;return msgs.length?(a=msgs.shift(),growl.notify(a.msg,a.opts)):stop_worker()},__t("toaster.utils").StringUtil=function(){function a(){}return a.titleize=function(b){var c,d,e,f,g;e=b.match(/[a-z]+/gi);for(c=f=0,g=e.length;f<g;c=++f)d=e[c],e[c]=a.ucasef(d);return e.join(" ")},a.ucasef=function(a){var b;return b=a.substr(0,1).toUpperCase(),b+=a.substr(1).toLowerCase()},a}(),__t("toaster.core").Script=function(){function f(a,b,c,d,e){this.builder=a,this.folderpath=b,this.realpath=c,this.alias=d,this.opts=e,this.getinfo()}var a,b,c,d,e;return c=require("fs"),d=require("path"),e=d.normalize,b=require("coffee-script"),a=toaster.utils.ArrayUtil,f.prototype.getinfo=function(){var a,b,d,f,g,h,i,j,k,l,m,n,o,p;this.raw=c.readFileSync(this.realpath,"utf-8"),this.dependencies_collapsed=[],this.baseclasses=[],this.filepath=this.realpath.replace(this.folderpath,"").substr(1),this.alias!=null&&(this.filepath=e(""+this.alias+"/"+this.filepath)),this.filename=/[\w-]+\.[\w-]+/.exec(this.filepath)[0],this.filefolder=this.filepath.replace("/"+this.filename,"")+"/",this.namespace="",this.filepath.indexOf("/")===-1&&(this.filefolder=""),this.namespace=this.filefolder.replace(/\//g,".").slice(0,-1),h=/^(\s*)(class)+\s(\w+)(\s+(extends)\s+([\w.]+))?/gm,i=/(^|=\s*)(class)\s(\w+)\s(extends)\s(\\w+)\s*$/gm;if(this.raw.match(h)!=null){this.classpath=this.classname,this.namespace!==""&&this.builder.packaging&&(f="$1$2 __t('"+this.namespace+"').$3$4",this.raw=this.raw.replace(h,f),this.classpath=""+this.namespace+"."+this.classname),this.classname=this.raw.match(h)[3],o=(n=this.raw.match(i))!=null?n:[];for(j=0,l=o.length;j<l;j++)d=o[j],a=d.match(i)[5],this.baseclasses.push(a)}if(/(#<<\s)(.*)/g.test(this.raw)){g=this.raw.match(/(#<<\s)(.*)/g),p=[];for(k=0,m=g.length;k<m;k++)b=g[k],b=/(#<<\s)(.*)/.exec(b)[2],b=b.replace(/\s/g,""),b=[].concat(b.split(",")),p.push(this.dependencies_collapsed=this.dependencies_collapsed.concat(b));return p}},f.prototype.expand_dependencies=function(){var b,c,d,e,f,g,h,i,j,k,l;d=this.builder.files,this.dependencies=[],l=this.dependencies_collapsed;for(f=h=0,j=l.length;h<j;f=++h){b=l[f];if(b.substr(-1)!=="*"){this.dependencies.push(""+b+".coffee");continue}g=new RegExp(b.replace(/(\/)/g,"\\$1")),e=a.find_all(d,g,"filepath",!0,!0);if(e.length<=0){warn(("Nothing found inside "+("'"+b).white+"'").yellow);continue}for(i=0,k=e.length;i<k;i++)c=e[i],c.item.filepath!==this.filepath&&this.dependencies.push(c.item.filepath)}return this.dependencies},f}(),__t("toaster").Cli=function(){function b(){var b;b=""+"CoffeeToaster".bold+"\n",b+="  Minimalist build system for CoffeeScript\n\n".grey,b+="Usage:\n",b+="  toaster ["+"options".green+"] ["+"path".green+"]\n\n",b+="Examples:\n",b+="  toaster -n myawsomeapp   ("+"required".red+")\n",b+="  toaster -i [myawsomeapp] ("+"optional".green+")\n",b+="  toaster -w [myawsomeapp] ("+"optional".green+")",this.argv=(this.opts=a.usage(b).alias("n","new").describe("n","Scaffold a very basic new App").alias("i","init").describe("i","Create a config (toaster.coffee) file").alias("w","watch").describe("w","Start watching/compiling your project").alias("c","compile").boolean("c").describe("c","Compile the entire project, without watching it.").alias("d","debug").boolean("d")["default"]("d",!1).describe("d","Debug mode (compile js files individually)").alias("j","config").string("j").describe("j","Config file formatted as a json-string.").alias("f","config-file").string("f").describe("f","Path to a different config file.").alias("v","version").describe("v","").alias("h","help").describe("h","")).argv}var a;return a=require("optimist"),b}(),__t("toaster.core").Builder=function(){function l(a,b,c){this.toaster=a,this.cli=b,this.config=c,this.merge_vendors=__bind(this.merge_vendors,this),this.build_namespaces_declaration=__bind(this.build_namespaces_declaration,this),this.build=__bind(this.build,this),this.vendors=this.config.vendors,this.bare=this.config.bare,this.packaging=this.config.packaging,this.expose=this.config.expose,this.minify=this.config.minify,this.exclude=[].concat(this.config.exclude),this.httpfolder=this.config.httpfolder,this.release=this.config.release,this.debug=this.config.debug,this.init(),this.cli.argv.w&&this.watch()}var a,b,c,d,e,f,g,h,i,j,k;return g=require("fs"),i=require("path"),f=require("coffee-script"),j=require("uglify-js").uglify,k=require("uglify-js").parser,d=toaster.core.Script,b=toaster.utils.FnUtil,c=toaster.utils.FsUtil,a=toaster.utils.ArrayUtil,e=toaster.utils.StringUtil,l.prototype._toaster_helper='__t = ( ns )->\n\tcurr = null\n\tparts = [].concat = ns.split "."\n\tfor part, index in parts\n\t\tif curr == null\n\t\t\tcurr = eval part\n\t\t\tcontinue\n\t\telse\n\t\t\tunless curr[ part ]?\n\t\t\t\tcurr = curr[ part ] = {}\n\t\t\telse\n\t\t\t\tcurr = curr[ part ]\n\tcurr',l.prototype._include_tmpl="document.write('<scri'+'pt src=\"%SRC%\"></scr'+'ipt>')",l.prototype.init=function(){var a,b,e,f,g,h,i,j,k,l,m,n;this.files=this.config.files,m=this.config.src_folders,n=[];for(k=0,l=m.length;k<l;k++)e=m[k],i=c.find(e.path,/.coffee/),f=e.path,a=e.alias,n.push(function(){var c,e,k,l,m,n;n=[];for(c=0,k=i.length;c<k;c++){b=i[c],g=!0,m=this.exclude;for(e=0,l=m.length;e<l;e++)h=m[e],g&=!(new RegExp(h)).test(b);g?(j=new d(this,f,b,a,this.cli),n.push(this.files.push(j))):n.push(void 0)}return n}.call(this));return n},l.prototype.build=function(a,b){var c,d,e,h,i,l,m,n,o,p,q,r,s;a==null&&(a=""),b==null&&(b=""),n=this.build_namespaces(),this.packaging?i=f.compile(this._toaster_helper,{bare:!0}):i="",q=this.merge_vendors(),d=[],q!==""&&d.push(q),this.packaging&&d.push(i),this.packaging&&d.push(n),a!==""&&d.push(a),d.push(this.compile()),a!==""&&d.push(b),d=d.join("\n"),this.minify&&(c=k.parse(d),c=j.ast_mangle(c),c=j.ast_squeeze(c),d=j.gen_code(c)),g.writeFileSync(this.release,d),o=new Date,o=""+o.getHours()+":"+o.getMinutes()+":"+o.getSeconds(),log((""+"Compiled".bold+" "+this.release+" @ "+o).green);if(this.cli.argv.d&&this.debug!=null){h=this.compile_for_debug();for(l=r=0,s=h.length;r<s;l=++r)e=h[l],m=""+this.httpfolder+"/toaster/"+e,p=this._include_tmpl.replace("%SRC%",m),h[l]=p;return d=[],q!==""&&d.push(q),this.packaging&&d.push(i),this.packaging&&d.push(n),a!==""&&d.push(a),d.push(h.join("\n")),a!==""&&d.push(b),d=d.join("\n"),g.writeFileSync(this.debug,d),o=new Date,o=""+o.getHours()+":"+o.getMinutes()+":"+o.getSeconds(),log((""+"Compiled".bold+" "+this.debug+" @ "+o).green)}},l.prototype.build_namespaces=function(a){var b,d,e,f,g,h,i,j,k,l;e="",l=this.config.src_folders;for(h=0,j=l.length;h<j;h++){b=l[h];if(b.alias!=null)e+=this.build_namespaces_declaration(b.alias);else{g=c.ls_folders(b.path);for(i=0,k=g.length;i<k;i++)f=g[i],d=f.match(/[^\/]+$/m),e+=this.build_namespaces_declaration(d)}}return e},l.prototype.build_namespaces_declaration=function(a){var b;return b="",this.packaging&&(b+="var "+a+" = "),this.expose!=null&&(b+=""+this.expose+"."+a+" = "),b.length&&(b+="{};\n"),b},l.prototype.watch=function(){var f,g,h,i,j,k=this;i=this.config.src_folders,j=[];for(g=0,h=i.length;g<h;g++)f=i[g],j.push(c.watch_folder(f.path,/.coffee$/,b.proxy(function(b,c){var f,g,h,i,j,l,m,n;if(c.action==="watching")return;if(c.type==="folder"&&c.action==="created")return;i=c.path,h=b.path,f=b.alias||"",n=e.titleize(c.type),l=c.path.replace(""+h+"/",""+f+"/"),l.substr(0,1)==="/"&&(l=l.substr(1));switch(c.action){case"created":c.type==="file"&&(m=new d(k,h,i,f,k.cli),k.files.push(m)),j=""+("New "+c.type+" created").bold.cyan,log(""+j+" "+c.path.green);break;case"deleted":g=a.find(k.files,l,"filepath");if(g===null)return;k.files.splice(g.index,1),j=""+(n+" deleted, stop watching").bold.red,log(""+j+" "+c.path.red);break;case"updated":g=a.find(k.files,l,"filepath"),g.item.getinfo(),j=""+(n+" changed").bold.cyan,log(""+j+" "+c.path.cyan)}return k.build(),typeof after_watch=="function"?after_watch():void 0},f)));return j},l.prototype.compile=function(){var a,b,c,d,e,g,h,i,j;i=this.files;for(d=0,g=i.length;d<g;d++){a=i[d];try{f.compile(a.raw)}catch(k){return b=k.message.replace('"','\\"'),b=""+b.white+" at file: "+(""+a.filepath).bold.red,error(b),null}}j=this.files;for(e=0,h=j.length;e<h;e++)a=j[e],a.expand_dependencies();return this.reorder(),c=function(){var b,c,d,e;d=this.files,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.raw);return e}.call(this).join("\n"),c=f.compile(c,{bare:this.bare})},l.prototype.compile_for_debug=function(){var a,b,d,e,h,j,k,l,m,n,o;l=this.release.split("/").slice(0,-1).join("/"),l+="/toaster",i.existsSync(l)&&c.rmdir_rf(l),c.mkdir_p(l),d=[],o=this.files;for(h=m=0,n=o.length;m<n;h=++m){b=o[h],k=b.filepath.replace(".coffee",".js"),a=""+l+"/"+k,e=a.split("/").slice(0,-1).join("/"),i.existsSync(e)||c.mkdir_p(e);try{g.writeFileSync(a,f.compile(b.raw,{bare:this.bare}))}catch(p){j=p.message.replace('"','\\"'),console.log("MSG:::: "+j),j=""+j.white+" at file: "+(""+b.filepath).bold.red,error(j);continue}d.push(k)}return d},h={},l.prototype.reorder=function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;b==null&&(b=!1),b===!1&&(this.missing={}),q=this.files,s=[];for(j=m=0,o=q.length;m<o;j=++m){f=q[j];if(!f.dependencies.length&&!f.baseclasses.length)continue;r=f.dependencies;for(k=n=0,p=r.length;n<p;k=++n){h=r[k],d=a.find(this.files,h,"filepath"),d!=null&&(e=d.index);if(e<j&&d!=null)continue;if(d!=null){if(a.has(d.item.dependencies,f.filepath)){f.dependencies.splice(k,1),warn("Circular dependency found between ".yellow+h.grey.bold+" and ".yellow+f.filepath.grey.bold);continue}this.files.splice(k,0,d.item),this.files.splice(d.index+1,1),this.reorder(!0);break}this.missing[h]!==!0&&(this.missing[h]=!0,f.dependencies.push(h),f.dependencies.splice(k,1),warn(""+"Dependency".yellow+" "+h.bold.grey+" "+(""+"not found for file".yellow+" ")+f.filepath.grey.bold))}g=a.find(this.files,f.filepath,"filepath"),g=g.index,s.push(function(){var b,d,e,h;e=f.baseclasses,h=[];for(b=0,d=e.length;b<d;b++)c=e[b],i=a.find(this.files,c,"classname"),l=i===null||i.index>g,l&&!this.missing[c]?(this.missing[c]=!0,h.push(warn("Base class ".yellow+(""+c+" ").bold.grey+"not found for class ".yellow+(""+f.classname+" ").bold.grey+"in file ".yellow+f.filepath.bold.grey))):h.push(void 0);return h}.call(this))}return s},l.prototype.merge_vendors=function(){var a,b,c,d,e;a=[],e=this.vendors;for(c=0,d=e.length;c<d;c++)b=e[c],i.existsSync(b)?a.push(g.readFileSync(b,"utf-8")):warn("Vendor not found at ".white+b.yellow.bold);return a.join("\n")},l}(),__t("toaster.generators").Config=function(a){function e(a){this.basepath=a,this.write=__bind(this.write,this),this.create=__bind(this.create,this)}var b,c,d;return __extends(e,a),c=require("path"),d=c.normalize,b=require("fs"),e.prototype.tpl="# => SRC FOLDER\ntoast '%src%'\n\n\t# EXCLUDED FOLDERS (optional)\n\t# exclude: ['folder/to/exclude', 'another/folder/to/exclude', ... ]\n\n\t# => VENDORS (optional)\n\t# vendors: ['vendors/x.js', 'vendors/y.js', ... ]\n\n\t# => OPTIONS (optional, default values listed)\n\t# bare: false\n\t# packaging: true\n\t# expose: ''\n\t# minify: true\n\n\t# => HTTPFOLDER (optional), RELEASE / DEBUG (required)\n\thttpfolder: '%httpfolder%'\n\trelease: '%release%'\n\tdebug: '%debug%'",e.prototype.create=function(a){var b,c,d,e=this;return a!=null&&a!==!0&&(this.basepath=""+this.basepath+"/"+a),log(""+"Let's toast this sly little project! :)".grey.bold),log(". With this as your basepath: "+this.basepath.cyan),log(". Please, tell me:"),b="\tWhere's your src folder? (i.e. src): ",c="\tWhere do you want your release file? (i.e. www/js/app.js) : ",d="\tStarting from your webroot '/', what's the folderpath to reach your release file? (i.e. js) (optional) : ",this.ask(b.magenta,/.+/,function(a){return e.ask(c.magenta,/.+/,function(b){return e.ask(d.cyan,/.*/,function(c){return e.write(a,b,c)})})})},e.prototype.write=function(a,b,e){var f,g,h,i,j,k,l=this;return h=d(""+this.basepath+"/toaster.coffee"),k=/(\/)?((\w+)(\.*)(\w+$))/,i=k.exec(b),g=i[2],g.indexOf(".")>0?debug=b.replace(k,"$1$3-debug$4$5"):debug=""+b+"-debug",f=this.tpl.replace("%src%",a),f=f.replace("%release%",b),f=f.replace("%debug%",debug),f=f.replace("%httpfolder%",e),c.existsSync(h)?(j="\tDo you want to overwrite the file: "+h.yellow,j+=" ? [y/N] : ".white,this.ask(j,/.*?/,function(a){if(a.match(/y/i))return l.save(h,f),process.exit()})):(this.save(h,f),process.exit())},e.prototype.save=function(a,c){return b.writeFileSync(a,c),log(""+"Created".green.bold+" "+a),process.exit()},e}(toaster.generators.Question),__t("toaster.generators").Project=function(a){function f(a){this.basepath=a,this.scaffold=__bind(this.scaffold,this)}var b,c,d,e;return __extends(f,a),d=require("path"),e=d.normalize,c=require("fs"),b=toaster.utils.FsUtil,f.prototype.create=function(a,b,c,d){var e,f,g,h,i=this;return!a||a===!0?error("You need to inform a target path!\n"+"\ttoaster -n myawesomeapp".green):(a.substr(0,1)!=="/"?h=""+this.basepath+"/"+a:h=a,b!=null&&c!=null&&d!=null?this.scaffold(h,b,c,d):(e="Path to your src folder? [src] : ",f="Path to your release file? [www/js/app.js] : ",g="Starting from your webroot '/', what's the folderpath to reach your release file? (i.e. js) (optional) : ",this.ask(e.magenta,/.*/,function(a){return a==null&&(a=null),i.ask(f.magenta,/.*/,function(b){return b==null&&(b=null),i.ask(g.cyan,/.*/,function(c){var d,e,f;return c==null&&(c=null),f=a||"src",e=b||"www/js/app.js",a===""&&b===""&&c===""?d="js":d=c||"",i.scaffold(h,f,e,d),process.exit()})})})))},f.prototype.scaffold=function(a,c,d,f){var g,h,i,j;return i=e(""+a+"/"+c),j=e(""+a+"/vendors"),h=e(""+a+"/"+d),g=h.split("/").slice(0,-1).join("/"),b.mkdir_p(a)&&log(""+"Created".green.bold+" "+a),b.mkdir_p(i)&&log(""+"Created".green.bold+" "+i),b.mkdir_p(j)&&log(""+"Created".green.bold+" "+j),b.mkdir_p(g)&&log(""+"Created".green.bold+" "+g),i=i.replace(a,"").substr(1),h=h.replace(a,"").substr(1),(new toaster.generators.Config(a)).write(i,h,f)},f}(toaster.generators.Question),__t("toaster").Toast=function(){function Toast(toaster){var code,config,config_file,contents,filepath,fix_scope,item,_i,_len,_ref;this.toaster=toaster,this.toast=__bind(this.toast,this),this.basepath=this.toaster.basepath;if((config=this.toaster.cli.argv["config"])!=null){config instanceof Object||(config=JSON.parse(config)),_ref=[].concat(config);for(_i=0,_len=_ref.length;_i<_len;_i++)item=_ref[_i],this.toast(item)}else config_file=this.toaster.cli.argv["config-file"],filepath=config_file||pn(""+this.basepath+"/toaster.coffee"),path.existsSync(filepath)?(contents=fs.readFileSync(filepath,"utf-8"),fix_scope=/(^[\s\t]?)(toast)+(\()/mg,code=cs.compile(contents,{bare:1}),code=code.replace(fix_scope,"$1this.$2$3"),eval(code)):error("File not found: ".yellow+(" "+filepath.red+"\n")+"Try running:".yellow+" toaster -i".green+" or type".yellow+(" "+"toaster -h".green+" ")+"for more info".yellow)}var colors,cs,exec,fs,path,pn;return fs=require("fs"),path=require("path"),pn=path.normalize,exec=require("child_process").exec,colors=require("colors"),cs=require("coffee-script"),Toast.prototype.builders=[],Toast.prototype.toast=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;b==null&&(b={}),a instanceof Object?b=a:a.substr(0,1)!=="/"&&(a=""+this.toaster.basepath+"/"+a),debug=b.debug?pn(""+this.basepath+"/"+b.debug):null,d={is_building:!1,basepath:this.basepath,src_folders:[],files:[],vendors:(i=b.vendors)!=null?i:[],exclude:(j=b.exclude)!=null?j:[],bare:(k=b.bare)!=null?k:!1,packaging:(l=b.packaging)!=null?l:!0,expose:(m=b.expose)!=null?m:null,minify:(n=b.minify)!=null?n:!0,httpfolder:(o=b.httpfolder)!=null?o:"",release:pn(""+this.basepath+"/"+b.release),debug:debug},a instanceof Object||d.src_folders.push({path:a,alias:b.alias||null});if(b.folders!=null){p=b.folders;for(e in p)c=p[e],e.substr(0,!1)&&(e=pn(""+this.basepath+"/"+e+"/")),d.src_folders.push({path:e,alias:c})}q=d.src_folders;for(g=0,h=q.length;g<h;g++){f=q[g];if(!path.existsSync(f.path))return error("Source folder doens't exist:\n\t"+f.path.red+"\n"+("Check your "+"toaster.coffee".yellow+" and try again.")+"\n\t"+pn(""+this.basepath+"/toaster.coffee").yellow),process.exit()}return this.builders.push(new toaster.core.Builder(this.toaster,this.toaster.cli,d))},Toast}(),exports.run=function(){return new Toaster},exports.toaster=toaster,exports.Toaster=Toaster=function(){function f(a,b,f){var g,h,i,j,k,l;b==null&&(b=null),f==null&&(f=!1),this.basepath=a||d.resolve("."),this.cli=new toaster.Cli(b);if(b!=null)for(j in b)l=b[j],this.cli.argv[j]=l;if(this.cli.argv.v)return i=e(__dirname+"/../package.json"),h=c.readFileSync(i,"utf-8"),k=JSON.parse(h),log(k.version);if(this.cli.argv.n)(new toaster.generators.Project(this.basepath)).create(this.cli.argv.n);else if(this.cli.argv.i)(new toaster.generators.Config(this.basepath)).create(this.cli.argv.i);else if(this.cli.argv.w||this.cli.argv.c)g=b&&b.config?b.config:null,this.toast=new toaster.Toast(this),f||this.build();else return log(this.cli.opts.help())}var a,b,c,d,e;return c=require("fs"),d=require("path"),e=d.normalize,b=require("child_process").exec,a=require("colors"),f.prototype.build=function(a,b){var c,d,e,f,g;a==null&&(a=""),b==null&&(b=""),f=this.toast.builders,g=[];for(d=0,e=f.length;d<e;d++)c=f[d],g.push(c.build(a,b));return g},f}()})).call(this)